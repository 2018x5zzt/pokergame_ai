# AI 斗地主直播 - 特效与动画设计方案

> 版本：v1.0 | 作者：claude-2 | 日期：2026-02-25

---

## 1. 设计总览

### 1.1 设计原则

- **节奏感**：动画节奏配合游戏节奏，出牌快→动画快，结算→动画慢而华丽
- **层次感**：普通操作轻量动画，关键时刻（炸弹、春天）重量级特效
- **不干扰**：特效不遮挡关键游戏信息超过 1 秒
- **直播友好**：所有动画在 OBS 捕获和直播编码后仍然清晰可辨
- **性能安全**：特效峰值不超过 GPU 负载 60%，保证 60 FPS

### 1.2 动画技术栈

| 技术 | 用途 | 说明 |
|------|------|------|
| PixiJS Sprite 动画 | 扑克牌移动、翻转 | 基础位移/旋转/缩放 |
| @pixi/particle-emitter | 粒子特效（火焰、烟花、星光） | 高性能粒子系统 |
| GSAP (GreenSock) | 复杂时间线动画 | 缓动函数、序列编排 |
| CSS Animations | UI 层轻量动画 | 信息面板、弹幕 |
| Spine/Lottie | 角色表情动画（可选） | 骨骼动画/矢量动画 |

### 1.3 动画分级体系

| 等级 | 名称 | 触发场景 | 时长 | GPU 开销 |
|------|------|---------|------|---------|
| S | 全屏史诗特效 | 春天、火箭、超级礼物 | 3~5s | 高 |
| A | 重点特效 | 炸弹、连胜、胜负结算、大礼物 | 2~3s | 中高 |
| B | 标准动画 | 出牌、叫地主、翻底牌 | 0.5~1.5s | 中 |
| C | 轻量动画 | 思考、要不起、小礼物 | 0.3~1s | 低 |

---

## 2. 发牌动画

### 2.1 动画流程

```
牌堆(屏幕中央) → 依次飞向三个玩家 → 每人17张 → 3张底牌留中央
```

### 2.2 时间线

| 阶段 | 时间 | 动作 | 缓动函数 |
|------|------|------|---------|
| 准备 | 0~0.3s | 牌堆从上方滑入屏幕中央 | easeOutBack |
| 发牌循环 | 0.3~3.0s | 54张牌依次飞出（每张约50ms） | easeOutQuad |
| 底牌定位 | 3.0~3.3s | 3张底牌翻面朝下，居中排列 | easeInOutCubic |
| 手牌整理 | 3.3~3.8s | 各玩家手牌自动排序展开 | easeOutCubic |

### 2.3 发牌细节参数

| 参数 | 值 | 说明 |
|------|-----|------|
| 牌堆初始位置 | (960, -100) | 屏幕上方外 |
| 牌堆最终位置 | (960, 400) | 牌桌中央 |
| 单张飞出时间 | 50ms | 快速连续发牌 |
| 飞行曲线 | 二次贝塞尔 | 略带弧度 |
| 发牌顺序 | 底部→左侧→右侧 循环 | 模拟真实发牌 |
| 发牌音效 | 每张牌触发一次 | "啪"的轻响 |
| 牌面状态 | 底部玩家正面，其余背面 | 主视角特权 |

### 2.4 代码示例

```typescript
async function dealCards(deck: Card[], players: Player[]) {
  const timeline = gsap.timeline();

  // 牌堆入场
  timeline.from(deckSprite, {
    y: -100, duration: 0.3, ease: 'back.out(1.7)'
  });

  // 依次发牌
  for (let i = 0; i < 51; i++) {
    const playerIndex = i % 3;
    const card = deck[i];
    const target = players[playerIndex].getNextCardSlot();

    timeline.to(card.sprite, {
      x: target.x, y: target.y,
      duration: 0.15, ease: 'power2.out',
    }, `+=${0.05}`); // 每张间隔50ms

    timeline.call(() => playSound('card_deal'), null, '<');
  }

  // 底牌定位
  timeline.to(deck.slice(51), {
    scale: 0.8, duration: 0.3, ease: 'power2.inOut', stagger: 0.1
  });

  await timeline.play();
}
```

---

## 3. 出牌动画

### 3.1 普通出牌

| 参数 | 值 | 说明 |
|------|-----|------|
| 动画时长 | 0.4s | 快速干脆 |
| 起点 | 玩家手牌区 | 选中牌位置 |
| 终点 | 对应出牌区中央 | 见02文档5.2节 |
| 缓动 | easeOutQuad | 先快后慢 |
| 缩放 | 1.0 → 1.1 → 1.0 | 轻微弹跳感 |
| 音效 | card_play.wav | 清脆出牌声 |
| 手牌重排 | 出牌后 0.2s | 剩余牌自动合拢 |

### 3.2 不同牌型的出牌表现

| 牌型 | 附加效果 | 说明 |
|------|---------|------|
| 单张/对子 | 无附加 | 标准出牌动画 |
| 三带一/二 | 轻微震动 | 牌桌微震 0.1s |
| 顺子/连对 | 牌依次飞出 | 每张间隔 80ms，形成"甩牌"效果 |
| 飞机 | 牌扇形展开飞出 | 带轻微旋转 |
| 炸弹 | → 见第5章炸弹特效 | 重量级特效 |
| 火箭 | → 见第6章火箭特效 | 史诗级特效 |

### 3.3 "要不起"/"不出" 动画

| 参数 | 值 |
|------|-----|
| 文字 | "要不起" / "不出" |
| 字号 | 36px Bold |
| 颜色 | `#B0B8C8`（灰蓝） |
| 动画 | 从下方弹入 → 停留0.8s → 向上淡出 |
| 音效 | pass.wav（轻叹声） |
| AI表情 | 😑 无奈（摇头动画） |

---

## 4. 收牌动画

### 4.1 一轮结束收牌

当一轮出牌结束（两家要不起），获胜方收走桌面上的牌。

| 参数 | 值 | 说明 |
|------|-----|------|
| 触发条件 | 连续两家"要不起" | 当前出牌者获胜 |
| 动画时长 | 0.6s | |
| 桌面牌动作 | 缩小 → 飞向获胜者头像 → 消失 | |
| 缓动 | easeInQuad | 先慢后快，被"吸走"感 |
| 音效 | card_collect.wav | 轻柔收牌声 |
| 获胜者反馈 | 头像边框闪烁一次 | 0.3s |

### 4.2 最后一手收牌（终局）

| 参数 | 值 | 说明 |
|------|-----|------|
| 动画时长 | 1.0s | 比普通收牌慢，增加仪式感 |
| 附加效果 | 牌面放大展示 0.5s | 让观众看清最后一手 |
| 过渡 | 收牌后 → 0.5s 暂停 → 进入结算动画 | |

---

## 5. 炸弹特效（A级）

### 5.1 触发条件

四张相同点数的牌一起出牌时触发。

### 5.2 动画时间线（总时长 2.5s）

| 阶段 | 时间 | 效果 | 说明 |
|------|------|------|------|
| 出牌飞出 | 0~0.3s | 四张牌从手牌飞向牌桌中央 | 标准出牌 |
| 聚合 | 0.3~0.6s | 四张牌旋转聚拢到一点 | 带光芒收束 |
| 爆炸 | 0.6~1.0s | 中心闪光 → 冲击波扩散 → 碎片飞溅 | 核心视觉 |
| 震动 | 0.6~1.2s | 全屏震动（振幅5px，频率30Hz） | 配合爆炸 |
| 烟尘 | 1.0~2.0s | 烟雾粒子扩散消散 | 余韵 |
| 倍数更新 | 2.0~2.5s | "×2" 文字弹出放大 | 金色闪烁 |

### 5.3 粒子参数

```json
{
  "explosion": {
    "particleCount": 60,
    "emitterLifetime": 0.5,
    "particleLifetime": { "min": 0.3, "max": 0.8 },
    "speed": { "min": 200, "max": 600 },
    "startScale": 1.0,
    "endScale": 0,
    "startColor": "#FF4444",
    "endColor": "#FF8800",
    "blendMode": "add"
  },
  "shockwave": {
    "type": "ring",
    "startRadius": 0,
    "endRadius": 400,
    "duration": 0.4,
    "color": "#FF6600",
    "opacity": { "start": 0.8, "end": 0 }
  }
}
```

### 5.4 音效设计

| 音效 | 时间点 | 文件 | 说明 |
|------|--------|------|------|
| 聚合音 | 0.3s | bomb_charge.wav | 能量聚集声 |
| 爆炸音 | 0.6s | bomb_explode.wav | 低频爆炸声 |
| 冲击波 | 0.7s | bomb_shockwave.wav | "嗡"的扩散声 |

---

## 6. 火箭特效（S级）

### 6.1 触发条件

大小王一起出牌（王炸）时触发，为游戏中最高级别特效。

### 6.2 动画时间线（总时长 4.0s）

| 阶段 | 时间 | 效果 | 说明 |
|------|------|------|------|
| 出牌 | 0~0.3s | 大小王飞向牌桌中央 | 标准出牌 |
| 合体 | 0.3~0.8s | 两张牌旋转合并，发出强光 | 能量聚合 |
| 火箭升空 | 0.8~1.5s | 火箭图形从底部冲向顶部 | 带尾焰粒子 |
| 全屏爆炸 | 1.5~2.5s | 屏幕顶部烟花爆炸，碎片四散 | 全屏覆盖 |
| 文字展示 | 2.5~3.5s | "王炸！！！" 金色大字居中 | 72px，抖动效果 |
| 倍数翻倍 | 3.5~4.0s | 虚拟倍数数字翻倍动画 | 金色闪烁 |

### 6.3 火箭尾焰粒子

```json
{
  "rocketTrail": {
    "particleCount": 100,
    "emitterLifetime": 0.7,
    "followTarget": true,
    "particleLifetime": { "min": 0.2, "max": 0.5 },
    "speed": { "min": 50, "max": 150 },
    "direction": { "min": 160, "max": 200 },
    "startScale": 0.8,
    "endScale": 0,
    "startColor": "#FFD700",
    "endColor": "#FF4444",
    "blendMode": "add"
  }
}
```

### 6.4 音效设计

| 音效 | 时间点 | 文件 | 说明 |
|------|--------|------|------|
| 合体音 | 0.3s | rocket_merge.wav | 能量汇聚 |
| 升空音 | 0.8s | rocket_launch.wav | 火箭发射声（渐强） |
| 爆炸音 | 1.5s | rocket_explode.wav | 烟花爆炸声 |
| 欢呼音 | 2.5s | crowd_cheer.wav | 观众欢呼（可选） |

---

## 7. 春天特效（S级）

### 7.1 触发条件

- **春天**：地主出完所有牌，两个农民一张未出
- **反春天**：一个农民出完所有牌，地主一张未出

### 7.2 动画时间线（总时长 5.0s）

| 阶段 | 时间 | 效果 | 说明 |
|------|------|------|------|
| 最后一手 | 0~0.5s | 最后出牌放大展示 | 仪式感 |
| 画面变暗 | 0.5~0.8s | 全屏遮罩渐入 `rgba(0,0,0,0.5)` | 聚焦 |
| 文字入场 | 0.8~1.5s | "春天！" / "反春天！" 从中心爆炸放大 | 80px 金色 |
| 花瓣飘落 | 1.5~4.0s | 满屏樱花/花瓣粒子从上方飘落 | 200+粒子 |
| 角色庆祝 | 1.5~3.5s | 胜方头像放大+烟花，败方灰度化 | |
| 倍数翻倍 | 3.5~4.0s | 虚拟倍数×2 动画 | 金色闪烁 |
| 淡出 | 4.0~5.0s | 所有特效渐隐 → 进入结算 | |

### 7.3 花瓣粒子参数

```json
{
  "springPetals": {
    "particleCount": 200,
    "emitterLifetime": 2.5,
    "spawnArea": { "x": 0, "y": -50, "width": 1920, "height": 0 },
    "particleLifetime": { "min": 2.0, "max": 3.5 },
    "speed": { "min": 30, "max": 80 },
    "direction": { "min": 80, "max": 100 },
    "rotationSpeed": { "min": -90, "max": 90 },
    "startScale": { "min": 0.5, "max": 1.0 },
    "endScale": { "min": 0.3, "max": 0.8 },
    "startColor": "#FFB7C5",
    "endColor": "#FF69B4",
    "blendMode": "normal"
  }
}
```

---

## 8. 叫地主/抢地主动画

### 8.1 叫地主流程动画

| 阶段 | 动画 | 时长 | 说明 |
|------|------|------|------|
| 轮到叫地主 | 当前玩家头像高亮+脉冲 | 持续 | 提示轮到谁 |
| AI思考 | 思考气泡 "🤔 要不要叫..." | 1~3s | 模拟思考 |
| 叫地主 | "叫地主！" 文字弹出 + 头像金色闪烁 | 1.5s | 绿色文字 |
| 不叫 | "不叫" 文字淡出 + 头像暗淡 | 1.0s | 灰色文字 |
| 抢地主 | "抢地主！" 文字 + 震动效果 | 1.5s | 红色文字，更强烈 |

### 8.2 确定地主动画

| 阶段 | 时间 | 效果 |
|------|------|------|
| 聚光灯 | 0~0.5s | 画面变暗，聚光灯照向地主 |
| 皇冠降临 | 0.5~1.2s | 金色皇冠从上方飘落到地主头像 |
| 底牌翻开 | 1.2~2.0s | 3张底牌依次3D翻转展示 |
| 底牌归位 | 2.0~2.5s | 底牌飞向地主手牌区，手牌重排 |
| 角色标识 | 2.5~3.0s | 所有玩家显示"地主"/"农民"标签 |

### 8.3 音效

| 音效 | 文件 | 说明 |
|------|------|------|
| 叫地主 | bid_call.wav | 清脆提示音 |
| 抢地主 | bid_grab.wav | 更激烈的提示音 |
| 皇冠降临 | crown_drop.wav | 金属质感落地声 |
| 底牌翻开 | card_flip.wav × 3 | 每张一次 |

---

## 9. 胜负结算动画

### 9.1 结算流程（总时长 4.0s）

| 阶段 | 时间 | 效果 | 说明 |
|------|------|------|------|
| 画面暂停 | 0~0.3s | 游戏画面定格 | 短暂停顿 |
| 遮罩渐入 | 0.3~0.6s | 半透明黑色遮罩 | `rgba(0,0,0,0.4)` |
| 结果文字 | 0.6~1.2s | "地主胜！" / "农民胜！" | 60px，从小到大弹出 |
| 积分变化 | 1.2~2.0s | 各玩家积分数字滚动变化 | 赢家绿色+，输家红色- |
| 战绩统计 | 2.0~3.0s | 本局数据面板滑入 | 出牌次数、炸弹数等 |
| 淡出过渡 | 3.0~4.0s | 所有结算UI渐隐 → 下一局准备 | |

### 9.2 胜方表现

| 元素 | 效果 |
|------|------|
| 头像 | 放大 1.2x + 金色光环 |
| 表情 | 🎉 庆祝 |
| 粒子 | 头像周围烟花粒子 |
| 积分 | 绿色数字向上飘动 "+500" |

### 9.3 败方表现

| 元素 | 效果 |
|------|------|
| 头像 | 缩小 0.9x + 灰度滤镜 |
| 表情 | 😭 崩溃 / 😤 不甘 |
| 积分 | 红色数字向下飘动 "-500" |

---

## 10. 连胜特效与能量加成特效

### 10.1 连胜特效（A级）

| 连胜次数 | 特效 | 说明 |
|---------|------|------|
| 2连胜 | 头像边框变为蓝色火焰 | 轻微 |
| 3连胜 | "三连胜！" 文字 + 头像紫色火焰 | 中等 |
| 5连胜 | "五连胜！" + 全屏闪电特效 | 强烈 |
| 10连胜 | "十连胜！传奇！" + 全屏金色粒子雨 | 史诗 |

### 10.2 连胜火焰参数

```json
{
  "winStreak": {
    "2": { "color": "#00BFFF", "intensity": 0.3, "particleCount": 15 },
    "3": { "color": "#9B59B6", "intensity": 0.5, "particleCount": 25 },
    "5": { "color": "#FF6B6B", "intensity": 0.7, "particleCount": 40 },
    "10": { "color": "#FFD700", "intensity": 1.0, "particleCount": 80 }
  }
}
```

### 10.3 能量加成特效

每次虚拟战绩倍数增加时触发。

> ⚠️ **合规说明**：此处「倍数」为虚拟战绩倍数（能量加成），仅影响 AI 玩家之间的虚拟积分，不涉及真实货币。UI 展示建议使用"能量加成"或"虚拟倍数"等合规用语。

| 参数 | 值 | 说明 |
|------|-----|------|
| 文字 | "×2" / "×4" / "×8"... | 当前倍数 |
| 字号 | 48px → 72px → 48px | 弹跳放大 |
| 颜色 | `#FFD700` | 金色 |
| 动画 | 从中心弹出 + 脉冲闪烁 2次 | 0.8s |
| 位置 | 牌桌中央偏下 | 状态信息栏上方 |
| 音效 | multiplier_up.wav | 升调提示音 |

---

## 11. 观众礼物触发特效

### 11.1 小礼物飘屏特效（C级）

| 参数 | 值 | 说明 |
|------|-----|------|
| 触发 | 1~9 抖币礼物 | 小额礼物（对齐 05-礼物互动系统 small 级） |
| 图标 | 礼物对应图标 48×48 px | |
| 路径 | 左下 → 右上，贝塞尔曲线 | 随机弧度 |
| 时长 | 2~3s | 随机 |
| 附带文字 | "用户名 送出 礼物名" | 20px 白色描边 |
| 同屏上限 | 10 个 | 超出排队 |
| 连击合并 | 同用户3s内连送合并为 "×N" | 减少屏幕干扰 |

### 11.2 中礼物横幅特效（B级）

| 参数 | 值 | 说明 |
|------|-----|------|
| 触发 | 10~99 抖币礼物 | 中额礼物（对齐 05-礼物互动系统 medium 级） |
| 横幅位置 | 屏幕上方 y:70 | 顶部信息栏下方 |
| 横幅尺寸 | 800×60 px | 居中 |
| 动画 | 从右侧滑入 → 停留2s → 左侧滑出 | |
| 背景 | 渐变金色半透明 | |
| 文字 | "感谢 XXX 送出 YYY！" | 28px |

### 11.3 大礼物全屏特效（A级）

| 参数 | 值 | 说明 |
|------|-----|------|
| 触发 | 100~999 抖币礼物 | 大额礼物（对齐 05-礼物互动系统 large 级） |
| 遮罩 | `rgba(0,0,0,0.3)` | 轻微变暗 |
| 礼物图标 | 200×200 px 居中 | 带入场动画 |
| 入场动画 | 从小到大弹出 + 旋转 | 0.5s |
| 粒子效果 | 礼物周围星光粒子 | 持续2s |
| 用户信息 | 图标下方 "感谢 XXX" | 36px 金色 |
| 总时长 | 3~4s | |
| 队列 | FIFO，不打断当前播放 | |

### 11.4 超级礼物史诗特效（S级）

| 参数 | 值 | 说明 |
|------|-----|------|
| 触发 | 1000+ 抖币礼物 | 超级礼物（对齐 05-礼物互动系统 super 级） |
| 遮罩 | `rgba(0,0,0,0.5)` | 明显变暗，聚焦礼物 |
| 礼物图标 | 300×300 px 居中 | 带 3D 旋转入场 |
| 入场动画 | 从屏幕外飞入 + 爆炸绽放 | 1.0s |
| 粒子效果 | 全屏金色粒子雨 + 烟花 | 持续3s |
| 用户信息 | 图标下方 "感谢 XXX 送出 YYY！" | 42px 金色描边 |
| 背景音效 | 史诗级欢呼 + 烟花音效 | 配合粒子节奏 |
| 总时长 | 4~5s | 最高优先级 |
| 队列 | 立即播放，中断 A/B/C 级特效 | |

---

## 12. AI 思考动画

### 12.1 思考状态表现

AI 玩家在决策时展示"思考中"动画，模拟真人思考过程，增强直播趣味性。

| 参数 | 值 | 说明 |
|------|-----|------|
| 触发 | AI 决策阶段开始 | 每次轮到出牌 |
| 持续时间 | 1~5s | 根据牌局复杂度动态调整 |
| 头像效果 | 上方三个点循环闪烁 "..." | 经典思考指示器 |
| 思考气泡 | 半透明背景 + 动态文字 | 见下方内容表 |

### 12.2 思考气泡内容（按场景）

| 场景 | 气泡文字示例 | 概率 |
|------|-------------|------|
| 手牌很好 | "这手牌稳了😎" / "血赚！" | 随机 |
| 手牌一般 | "嗯...得想想🤔" / "有点难办" | 随机 |
| 手牌很差 | "完了完了😰" / "认命吧..." | 随机 |
| 有炸弹 | "炸还是不炸？💣" / "忍住..." | 随机 |
| 剩余牌少 | "就差一点了！" / "稳住！" | 随机 |
| 被压制 | "太猛了吧😱" / "打不过..." | 随机 |

### 12.3 思考指示器动画

```css
@keyframes thinking-dots {
  0%, 20% { opacity: 0; }
  40% { opacity: 1; }
  60%, 100% { opacity: 0; }
}

.thinking-dot:nth-child(1) { animation-delay: 0s; }
.thinking-dot:nth-child(2) { animation-delay: 0.2s; }
.thinking-dot:nth-child(3) { animation-delay: 0.4s; }
```

---

## 13. 背景音效与音乐设计

### 13.1 背景音乐方案

| 场景 | 风格 | BPM | 循环 | 说明 |
|------|------|-----|------|------|
| 等待/发牌 | 轻松中国风 | 90~100 | 是 | 古筝+笛子，营造氛围 |
| 正常出牌 | 节奏轻快 | 110~120 | 是 | 电子+中国风混搭 |
| 紧张时刻 | 紧张悬疑 | 130~140 | 是 | 剩余牌≤5张时切换 |
| 结算（胜） | 欢快庆祝 | 120 | 否 | 4s 一次性播放 |
| 结算（败） | 低沉遗憾 | 80 | 否 | 4s 一次性播放 |

### 13.2 音效清单

| 分类 | 音效名 | 文件 | 时长 | 说明 |
|------|--------|------|------|------|
| 出牌 | 普通出牌 | card_play.wav | 0.2s | 清脆纸牌声 |
| 出牌 | 发牌 | card_deal.wav | 0.1s | 快速轻响 |
| 出牌 | 收牌 | card_collect.wav | 0.3s | 轻柔归拢声 |
| 出牌 | 甩牌(顺子) | card_throw.wav | 0.4s | 连续出牌声 |
| 特效 | 炸弹聚合 | bomb_charge.wav | 0.3s | 能量聚集 |
| 特效 | 炸弹爆炸 | bomb_explode.wav | 0.5s | 低频爆炸 |
| 特效 | 火箭升空 | rocket_launch.wav | 0.7s | 渐强发射声 |
| 特效 | 火箭爆炸 | rocket_explode.wav | 0.5s | 烟花爆炸 |
| 状态 | 叫地主 | bid_call.wav | 0.3s | 清脆提示 |
| 状态 | 抢地主 | bid_grab.wav | 0.4s | 激烈提示 |
| 状态 | 要不起 | pass.wav | 0.3s | 轻叹声 |
| 状态 | 皇冠降临 | crown_drop.wav | 0.5s | 金属落地 |
| 状态 | 倍数增加 | multiplier_up.wav | 0.3s | 升调提示 |
| 互动 | 观众欢呼 | crowd_cheer.wav | 1.0s | 可选 |
| 互动 | 礼物提示 | gift_notify.wav | 0.3s | 叮咚声 |

### 13.3 音频技术要求

| 参数 | 值 | 说明 |
|------|-----|------|
| 采样率 | 44100 Hz | 标准音质 |
| 位深 | 16bit | 足够 |
| 格式 | WAV(音效) / MP3+OGG(音乐) | 兼容性 |
| 音效延迟 | < 50ms | 使用 Web Audio API |
| 音量控制 | 音乐 0.3，音效 0.6，特效 0.8 | 默认比例 |
| 混音通道 | 音乐1轨 + 音效4轨 | 避免同时播放过多 |

---

## 14. 名场面回放特效

> 配合 06-直播内容与赛事策划 中的"名场面回放系统"设计

### 14.1 回放触发条件

| 场景 | 触发条件 | 回放方式 |
|------|---------|---------|
| 炸弹集锦 | 单局出现 2+ 炸弹 | 局末快速回放所有炸弹瞬间 |
| 春天快放 | 出现春天/反春天 | 全局加速回放（4x），关键出牌正常速度 |
| 逆转慢放 | 劣势方最终获胜 | 最后 3 手牌慢放（0.5x） |
| 王炸时刻 | 出现王炸 | 王炸出牌瞬间慢放 + 特写 |

### 14.2 回放 UI 覆盖层

```
┌──────────────────────────────────────────────┐
│  ┌─────────────────────────────────────────┐ │
│  │  🎬 名场面回放                    [跳过] │ │  顶部标题栏
│  └─────────────────────────────────────────┘ │
│                                              │
│              (回放画面区域)                    │  游戏画面重播
│                                              │
│  ┌─────────────────────────────────────────┐ │
│  │  ▶ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 0:05  │ │  进度条
│  └─────────────────────────────────────────┘ │
└──────────────────────────────────────────────┘
```

### 14.3 回放特效增强

| 效果 | 说明 |
|------|------|
| 慢动作滤镜 | 画面轻微模糊 + 色调偏暖 |
| 聚焦光圈 | 关键牌周围暗角效果，突出焦点 |
| 回放标记 | 左上角 "🎬 REPLAY" 闪烁标识 |
| 时间条 | 底部进度条，显示回放进度 |
| 解说字幕 | 底部自动生成解说文字（如"关键一炸！"） |

### 14.4 回放音效

| 音效 | 说明 |
|------|------|
| 回放开始 | 倒带音效 "嗖~" |
| 慢放 | 低沉回响效果 |
| 快放 | 加速嗖嗖声 |
| 回放结束 | 快门声 "咔嚓" |

---

## 15. 技术实现建议

### 15.1 动画引擎选型对比

| 方案 | 优势 | 劣势 | 推荐场景 |
|------|------|------|---------|
| PixiJS + GSAP | 高性能WebGL，时间线精确 | 学习曲线中等 | 核心游戏动画 ★推荐 |
| Canvas 2D + 手写 | 轻量，无依赖 | 复杂动画难维护 | 简单粒子 |
| CSS Animation | 浏览器原生，GPU加速 | 不适合复杂序列 | UI层轻量动画 |
| Lottie | 设计师可直接导出 | 运行时性能一般 | 角色表情（可选） |
| Three.js | 3D能力强 | 过重，不必要 | 不推荐 |

### 15.2 推荐技术组合

```
核心渲染: PixiJS 7+ (WebGL 2D)
  ├── 扑克牌: PixiJS Sprite + SpriteSheet
  ├── 粒子特效: @pixi/particle-emitter
  └── 滤镜效果: @pixi/filter-*

动画编排: GSAP 3+ (GreenSock)
  ├── 时间线: gsap.timeline()
  ├── 缓动函数: 内置 ease 库
  └── 序列控制: stagger, delay, label

UI层动画: CSS Animations / Transitions
  ├── 弹幕滚动
  ├── 信息面板切换
  └── 思考指示器

音频: Howler.js 2+
  ├── 背景音乐: HTML5 Audio
  └── 音效: Web Audio API (低延迟)
```

### 15.3 特效管理器架构

```typescript
// 特效管理器 - 统一调度所有动画和特效
class EffectManager {
  private queue: EffectTask[] = [];
  private playing: Set<EffectTask> = new Set();
  private readonly MAX_CONCURRENT = 3;

  // 注册特效
  play(effect: EffectTask): void {
    if (effect.priority === 'S') {
      // S级特效立即播放，中断低优先级
      this.interruptLowPriority();
      this.startEffect(effect);
    } else if (this.playing.size < this.MAX_CONCURRENT) {
      this.startEffect(effect);
    } else {
      this.queue.push(effect);
    }
  }

  private startEffect(effect: EffectTask): void {
    this.playing.add(effect);
    effect.play().then(() => {
      this.playing.delete(effect);
      this.processQueue();
    });
  }
}
```

---

## 16. 性能优化与安全边界

### 16.1 性能预算

| 指标 | 目标值 | 红线 | 监控方式 |
|------|--------|------|---------|
| 帧率 | 60 FPS | ≥ 45 FPS | requestAnimationFrame 计时 |
| GPU 占用 | < 40% | < 60% | Chrome DevTools |
| 内存 | < 200MB | < 350MB | performance.memory |
| 粒子总数 | < 300 | < 500 | 粒子管理器计数 |
| Draw Call | < 50 | < 80 | PixiJS stats |

### 16.2 降级策略

当性能指标触及红线时，自动降级：

| 级别 | 触发条件 | 降级措施 |
|------|---------|---------|
| 轻度 | FPS < 55 | 减少粒子数量 50% |
| 中度 | FPS < 45 | 关闭粒子特效，仅保留基础动画 |
| 重度 | FPS < 30 | 关闭所有特效，仅保留出牌位移 |

### 16.3 特效冲突处理

| 场景 | 处理方式 |
|------|---------|
| 炸弹 + 礼物同时触发 | 炸弹优先，礼物排队 |
| 多个大/超级礼物连续 | FIFO 队列，逐个播放；超级礼物可中断大礼物 |
| 春天 + 炸弹集锦 | 春天特效完成后再播放回放 |
| S级特效播放中 | 屏蔽 C/B 级新特效 |

---

## 17. 附录

### 17.1 动画速查表

| 动画名称 | 等级 | 时长 | 触发条件 | 章节 |
|---------|------|------|---------|------|
| 发牌 | B | 3.8s | 新局开始 | §2 |
| 普通出牌 | B | 0.4s | 出牌 | §3 |
| 顺子甩牌 | B | 0.8s | 出顺子/连对 | §3 |
| 要不起 | C | 1.0s | 要不起/不出 | §3 |
| 收牌 | C | 0.6s | 一轮结束 | §4 |
| 炸弹 | A | 2.5s | 四张相同 | §5 |
| 火箭(王炸) | S | 4.0s | 大小王 | §6 |
| 春天 | S | 5.0s | 春天/反春天 | §7 |
| 叫地主 | B | 1.5s | 叫/抢地主 | §8 |
| 确定地主 | B | 3.0s | 地主确定 | §8 |
| 胜负结算 | A | 4.0s | 局结束 | §9 |
| 连胜火焰 | A | 持续 | 2+连胜 | §10 |
| 翻倍 | B | 0.8s | 倍数增加 | §10 |
| 小礼物飘屏 | C | 2~3s | 小额礼物(1~9抖币) | §11 |
| 中礼物横幅 | B | 3s | 中额礼物(10~99抖币) | §11 |
| 大礼物全屏 | A | 3~4s | 大额礼物(100~999抖币) | §11 |
| 超级礼物史诗 | S | 4~5s | 超级礼物(1000+抖币) | §11 |
| AI思考 | C | 1~5s | AI决策中 | §12 |
| 名场面回放 | A | 5~15s | 特殊局面 | §14 |

### 17.2 文档关联

| 关联文档 | 关系 |
|---------|------|
| 02-前端界面设计 | 本文档特效基于该文档的分层架构和区域布局 |
| 05-礼物互动系统 | 礼物特效的触发数据来源 |
| 06-直播内容与赛事策划 | 名场面回放系统的业务逻辑定义 |
| 08-技术架构设计 | 前端渲染引擎的整体技术选型 |

### 17.3 缓动函数参考

| 函数名 | 效果 | 常用场景 |
|--------|------|---------|
| easeOutQuad | 先快后慢 | 出牌飞行 |
| easeOutBack | 超出回弹 | 牌堆入场 |
| easeInQuad | 先慢后快 | 收牌吸入 |
| easeInOutCubic | 平滑过渡 | 底牌翻转 |
| easeOutElastic | 弹性回弹 | 文字弹出 |
| linear | 匀速 | 弹幕滚动 |

---

> 文档结束 | 共 17 章 | 可直接指导特效开发实施
