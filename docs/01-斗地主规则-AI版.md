# 斗地主规则定义 —— AI 智能体版

> 版本：v1.0 | 日期：2026-02-25 | 用途：供 AI 智能体精确理解和执行斗地主游戏规则
>
> ⚠️ 本文档采用结构化格式编写，所有规则均为确定性描述，无歧义。AI 智能体应严格按照本文档执行游戏逻辑。

---

## 一、游戏基本信息

| 属性 | 值 |
|------|-----|
| 游戏名称 | 斗地主（Fight the Landlord） |
| 玩家数量 | 3 |
| 使用牌组 | 一副标准扑克牌，54张 |
| 阵营 | 地主（1人） vs 农民（2人） |
| 胜利条件 | 率先出完所有手牌的一方获胜 |
| 游戏类型 | 非完全信息博弈、多智能体对抗 |

---

## 二、牌的定义

### 2.1 牌的组成（54张）

| 类别 | 花色 | 点数 | 数量 | 说明 |
|------|------|------|------|------|
| 普通牌 | ♠♥♦♣ | 3,4,5,6,7,8,9,10,J,Q,K,A,2 | 52张 | 每个点数4张（4种花色） |
| 大王 | - | BigJoker | 1张 | 最大单牌 |
| 小王 | - | SmallJoker | 1张 | 次大单牌 |

### 2.2 单牌大小排序（从小到大）

```
3 < 4 < 5 < 6 < 7 < 8 < 9 < 10 < J < Q < K < A < 2 < 小王(SmallJoker) < 大王(BigJoker)
```

### 2.3 牌的数据结构定义（供程序实现参考）

```typescript
// 点数枚举（数值越大牌越大）
enum CardRank {
  THREE = 3,
  FOUR = 4,
  FIVE = 5,
  SIX = 6,
  SEVEN = 7,
  EIGHT = 8,
  NINE = 9,
  TEN = 10,
  JACK = 11,    // J
  QUEEN = 12,   // Q
  KING = 13,    // K
  ACE = 14,     // A
  TWO = 15,     // 2
  SMALL_JOKER = 16,  // 小王
  BIG_JOKER = 17     // 大王
}

// 花色枚举
enum CardSuit {
  SPADE = "♠",    // 黑桃
  HEART = "♥",    // 红心
  DIAMOND = "♦",  // 方块
  CLUB = "♣",     // 梅花
  JOKER = "🃏"    // 王牌（无花色）
}

// 牌的数据结构
interface Card {
  rank: CardRank;
  suit: CardSuit;
  display: string;  // 显示文本，如 "♠A", "大王"
}
```

---

## 三、发牌规则

### 3.1 发牌流程

```
步骤1: 将54张牌充分洗牌（随机打乱）
步骤2: 按顺序给3个玩家各发17张牌
步骤3: 剩余3张牌作为"底牌"，暂时扣下
步骤4: 进入叫地主阶段
```

### 3.2 发牌约束
- 每个玩家初始获得 **17张** 手牌
- 底牌为 **3张**
- 发牌后，每个玩家只能看到自己的手牌，不能看到其他玩家的手牌（非完全信息）
- 底牌在地主确定前不公开

---

## 四、叫地主规则

### 4.1 叫地主流程

```
步骤1: 系统随机指定一名玩家为"首叫玩家"
步骤2: 首叫玩家选择：叫地主(1分/2分/3分) 或 不叫
步骤3: 按座位顺序（顺时针），下一位玩家选择：
        - 叫更高的分数（必须高于当前最高叫分）
        - 不叫（放弃本轮叫地主权利）
步骤4: 当某玩家叫3分（最高分），立即成为地主
步骤5: 或者三人都表态后，叫分最高者成为地主
步骤6: 若三人都不叫，重新洗牌发牌，重新叫地主
```

### 4.2 叫分规则详解

| 叫分值 | 含义 | 约束 |
|--------|------|------|
| 1分 | 基础叫地主 | 首叫玩家可选 |
| 2分 | 加倍叫地主 | 必须高于当前最高叫分 |
| 3分 | 满分叫地主 | 直接确定为地主，不再继续叫分 |
| 不叫 | 放弃 | 本轮不再有叫地主机会 |

### 4.3 地主确定后

```
步骤1: 公开3张底牌（所有玩家可见）
步骤2: 底牌加入地主手牌（地主手牌变为20张）
步骤3: 记录叫分值作为本局基础倍数
步骤4: 地主获得首先出牌权
```

### 4.4 AI 叫地主决策输入

AI 在叫地主时可获得的信息：
- 自己的17张手牌
- 当前已有的叫分情况（谁叫了几分、谁不叫）
- 自己的座位位置

AI 不可获得的信息：
- 其他玩家的手牌
- 底牌内容

---

## 五、牌型定义

### 5.1 所有合法牌型一览

| 编号 | 牌型名称 | 英文标识 | 张数 | 定义 | 示例 |
|------|----------|----------|------|------|------|
| 1 | 单张 | SINGLE | 1 | 任意一张牌 | 3, A, 大王 |
| 2 | 对子 | PAIR | 2 | 两张点数相同的牌 | 33, AA |
| 3 | 三条 | TRIPLE | 3 | 三张点数相同的牌 | 333, AAA |
| 4 | 三带一 | TRIPLE_WITH_SINGLE | 4 | 三条 + 一张单牌 | 333+5, AAA+3 |
| 5 | 三带一对 | TRIPLE_WITH_PAIR | 5 | 三条 + 一个对子 | 333+55, AAA+KK |
| 6 | 顺子 | STRAIGHT | ≥5 | 五张或更多点数连续的单牌 | 34567, 3456789 |
| 7 | 连对 | STRAIGHT_PAIR | ≥6(偶数) | 三对或更多连续点数的对子 | 334455, 33445566 |
| 8 | 飞机不带 | AIRPLANE | ≥6(3的倍数) | 两组或更多连续点数的三条 | 333444, 333444555 |
| 9 | 飞机带单 | AIRPLANE_WITH_SINGLES | 变化 | 飞机 + 等量单牌 | 333444+5+6 |
| 10 | 飞机带对 | AIRPLANE_WITH_PAIRS | 变化 | 飞机 + 等量对子 | 333444+55+66 |
| 11 | 四带二单 | FOUR_WITH_TWO_SINGLES | 6 | 四条 + 两张不同单牌 | 3333+5+6 |
| 12 | 四带二对 | FOUR_WITH_TWO_PAIRS | 8 | 四条 + 两个不同对子 | 3333+55+66 |
| 13 | 炸弹 | BOMB | 4 | 四张点数相同的牌 | 3333, AAAA |
| 14 | 火箭(王炸) | ROCKET | 2 | 大王 + 小王 | 大王+小王 |

### 5.2 牌型详细规则

#### 5.2.1 顺子（STRAIGHT）
- 最少 **5张** 连续单牌
- 最多 **12张**（3到A，共12个连续点数）
- **不能包含 2**
- **不能包含大小王**
- 比较规则：相同长度的顺子，比较最大牌的点数

```
合法示例: 34567, 45678910, 3456789JQKA (不合法，缺10)
           3456789 10JQKA (合法，12张)
非法示例: JQKA2 (包含2), 34567+小王 (包含王)
```

#### 5.2.2 连对（STRAIGHT_PAIR）
- 最少 **3对**（6张）连续对子
- **不能包含 2**
- **不能包含大小王**
- 比较规则：相同长度的连对，比较最大对子的点数

```
合法示例: 334455, 33445566, 778899
非法示例: KKAA22 (包含2)
```

#### 5.2.3 飞机（AIRPLANE）
- 最少 **2组** 连续三条
- **不能包含 2**
- **不能包含大小王**
- 带的牌不能是炸弹

```
飞机不带: 333444, 333444555
飞机带单: 333444+5+6 (带的单牌可以相同点数但不能是对子形式)
飞机带对: 333444+55+66
```

#### 5.2.4 炸弹（BOMB）
- 四张点数相同的牌
- 可以压制除火箭外的任何牌型
- 炸弹之间比较点数大小
- 出炸弹时，本局倍数 ×2

#### 5.2.5 火箭/王炸（ROCKET）
- 大王 + 小王
- 最大牌型，可以压制任何牌（包括炸弹）
- 出火箭时，本局倍数 ×2

### 5.3 牌型比较规则总表

| 规则 | 说明 |
|------|------|
| 同类型比较 | 相同牌型且相同张数，比较主牌点数大小 |
| 炸弹压制 | 炸弹可以压制除火箭外的任何牌型 |
| 火箭压制 | 火箭可以压制任何牌型（包括炸弹） |
| 不同类型 | 除炸弹和火箭外，不同牌型之间不能比较 |
| 长度匹配 | 顺子、连对、飞机必须长度相同才能比较 |

### 5.4 牌型识别的数据结构

```typescript
enum HandType {
  SINGLE = "SINGLE",
  PAIR = "PAIR",
  TRIPLE = "TRIPLE",
  TRIPLE_WITH_SINGLE = "TRIPLE_WITH_SINGLE",
  TRIPLE_WITH_PAIR = "TRIPLE_WITH_PAIR",
  STRAIGHT = "STRAIGHT",
  STRAIGHT_PAIR = "STRAIGHT_PAIR",
  AIRPLANE = "AIRPLANE",
  AIRPLANE_WITH_SINGLES = "AIRPLANE_WITH_SINGLES",
  AIRPLANE_WITH_PAIRS = "AIRPLANE_WITH_PAIRS",
  FOUR_WITH_TWO_SINGLES = "FOUR_WITH_TWO_SINGLES",
  FOUR_WITH_TWO_PAIRS = "FOUR_WITH_TWO_PAIRS",
  BOMB = "BOMB",
  ROCKET = "ROCKET",
  PASS = "PASS"  // 不出
}

interface PlayedHand {
  type: HandType;
  cards: Card[];
  mainRank: CardRank;  // 主牌点数（用于比较大小）
  length: number;       // 顺子/连对/飞机的长度
}
```

---

## 六、出牌规则

### 6.1 出牌顺序
1. 地主拥有 **首先出牌权**
2. 之后按 **顺时针方向** 轮流出牌
3. 座位顺序固定：玩家A → 玩家B → 玩家C → 玩家A → ...

### 6.2 出牌规则

```
规则1: 轮到自己出牌时，有两种选择：
       a) 出牌：打出一组合法牌型
       b) 不出（PASS）：放弃本轮出牌权

规则2: 如果是"自由出牌"（上一轮无人出牌或自己是新一轮首出），
       可以出任意合法牌型

规则3: 如果是"跟牌"（需要压过上家的牌），必须满足：
       a) 出的牌型与上家相同（或出炸弹/火箭）
       b) 出的牌比上家的牌大
       c) 顺子/连对/飞机的长度必须与上家相同

规则4: 如果连续两人都选择"不出"，则最后出牌的玩家获得新一轮
       的自由出牌权
```

### 6.3 出牌合法性判断流程

```
输入: 当前玩家手牌, 要出的牌, 上一手牌(可能为空)

if 上一手牌为空 (自由出牌):
    return 要出的牌是否为合法牌型

if 要出的牌是火箭:
    return true  // 火箭压一切

if 要出的牌是炸弹:
    if 上一手牌是火箭:
        return false
    if 上一手牌是炸弹:
        return 要出的炸弹点数 > 上一手炸弹点数
    return true  // 炸弹压非炸弹

if 要出的牌型 != 上一手牌型:
    return false  // 牌型不同不能压

if 要出的牌长度 != 上一手牌长度:
    return false  // 长度不同不能压（顺子/连对/飞机）

return 要出的牌主牌点数 > 上一手牌主牌点数
```

### 6.4 AI 出牌决策输入

AI 在出牌时可获得的信息：
- 自己当前的手牌
- 上一手出的牌（牌型、具体牌面）及出牌者
- 当前是自由出牌还是跟牌
- 所有玩家已出过的牌（历史记录）
- 每个玩家剩余手牌数量
- 自己的角色（地主/农民）
- 队友是谁（农民视角）

AI 不可获得的信息：
- 其他玩家当前手牌的具体内容

---

## 七、胜负判定

### 7.1 胜利条件

| 阵营 | 胜利条件 |
|------|----------|
| 地主 | 地主率先出完所有手牌 |
| 农民 | 任意一名农民率先出完所有手牌 |

### 7.2 特殊胜负情况

| 情况 | 名称 | 说明 | 倍数影响 |
|------|------|------|----------|
| 地主一手未出就被农民出完 | 春天（被闷） | 地主一张牌都没出过，农民就赢了 | 倍数 ×2 |
| 地主出完牌，两个农民一手未出 | 反春天 | 地主出完牌时，两个农民都没出过牌 | 倍数 ×2 |

### 7.3 判定"春天"的精确条件

```
春天条件（农民赢）:
  地主在整局游戏中出牌次数 == 0
  即：地主首次出牌后，还没轮到地主第二次出牌，某农民就已出完

反春天条件（地主赢）:
  两个农民在整局游戏中出牌次数均 == 0
  即：地主连续出牌直到出完，两个农民全程都选择了"不出"或没有机会出牌
```

---

## 八、计分系统

### 8.1 倍数计算

本局最终倍数 = 基础倍数 × 炸弹/火箭倍数 × 春天倍数

| 倍数来源 | 计算方式 | 说明 |
|----------|----------|------|
| 基础倍数 | 叫地主时的叫分值（1/2/3） | 叫几分就是几倍 |
| 炸弹倍数 | 每出一个炸弹，总倍数 ×2 | 累计计算 |
| 火箭倍数 | 出火箭，总倍数 ×2 | 累计计算 |
| 春天倍数 | 春天或反春天，总倍数 ×2 | 最多触发一次 |

### 8.2 积分结算

```
设最终倍数为 M:

地主赢:
  地主积分 += 2 × M  (赢两个农民的分)
  农民A积分 -= M
  农民B积分 -= M

农民赢:
  地主积分 -= 2 × M
  农民A积分 += M
  农民B积分 += M
```

### 8.3 积分示例

| 场景 | 叫分 | 炸弹数 | 春天 | 最终倍数 | 地主赢时地主得分 |
|------|------|--------|------|----------|-----------------|
| 普通局 | 1分 | 0 | 否 | 1 | +2 |
| 高分局 | 3分 | 0 | 否 | 3 | +6 |
| 炸弹局 | 2分 | 2个 | 否 | 2×2×2=8 | +16 |
| 春天局 | 3分 | 1个 | 是 | 3×2×2=12 | +24 |

---

## 九、游戏流程状态机

### 9.1 状态定义

```
WAITING      → 等待开始
DEALING      → 发牌中
BIDDING      → 叫地主阶段
PLAYING      → 出牌阶段
ROUND_END    → 本局结算
GAME_OVER    → 游戏结束（多局制时达到终止条件）
```

### 9.2 状态转换图

```
WAITING → DEALING → BIDDING → PLAYING → ROUND_END → DEALING (下一局)
                       ↓                      ↓
                  (全不叫)→ DEALING        GAME_OVER
```

### 9.3 完整单局流程

```
1. [DEALING]   洗牌 → 发牌(每人17张) → 留底牌(3张)
2. [BIDDING]   随机首叫 → 轮流叫分 → 确定地主 → 底牌归地主
               (若全不叫 → 回到步骤1)
3. [PLAYING]   地主首出 → 顺时针轮流出牌/不出
               → 某玩家出完所有牌 → 判定胜负
4. [ROUND_END] 计算倍数 → 结算积分 → 记录战绩
               → 进入下一局或结束
```

---

## 十、AI 通信协议

### 10.1 游戏引擎 → AI 的消息格式

#### 10.1.1 发牌通知

```json
{
  "type": "DEAL",
  "player_id": "AI-Alpha",
  "role": null,
  "hand": ["♠3","♥3","♦4","♣5","♠6","♥7","♦8","♣9","♠10","♥J","♦Q","♣K","♠A","♥A","♦2","♣2","大王"],
  "hand_count": 17,
  "seat_order": ["AI-Alpha", "AI-Beta", "AI-Gamma"]
}
```

#### 10.1.2 叫地主请求

```json
{
  "type": "BID_REQUEST",
  "player_id": "AI-Alpha",
  "current_highest_bid": 1,
  "bid_history": [
    {"player": "AI-Beta", "bid": 1},
    {"player": "AI-Gamma", "bid": 0}
  ],
  "available_bids": [2, 3, 0]
}
```

#### 10.1.3 出牌请求

```json
{
  "type": "PLAY_REQUEST",
  "player_id": "AI-Alpha",
  "hand": ["♠3","♥7","♦8","♣9","♠10","♥J","♦Q","♣K","♠A","♥A","♦2","♣2","大王"],
  "is_free_play": false,
  "last_play": {
    "player": "AI-Beta",
    "type": "PAIR",
    "cards": ["♠5","♥5"],
    "main_rank": 5
  },
  "play_history": [],
  "remaining_cards": {"AI-Alpha": 13, "AI-Beta": 15, "AI-Gamma": 16},
  "role": "landlord",
  "teammates": []
}
```

### 10.2 AI → 游戏引擎的响应格式

#### 10.2.1 叫地主响应

```json
{
  "type": "BID_RESPONSE",
  "player_id": "AI-Alpha",
  "bid": 3,
  "comment": "这把牌太好了，我全要！"
}
```

#### 10.2.2 出牌响应

```json
{
  "type": "PLAY_RESPONSE",
  "player_id": "AI-Alpha",
  "action": "PLAY",
  "cards": ["♥A","♠A"],
  "hand_type": "PAIR",
  "comment": "对A镇场！",
  "emotion": "confident",
  "strategy_hint": "先出大对子试探对手实力"
}
```

#### 10.2.3 不出响应

```json
{
  "type": "PLAY_RESPONSE",
  "player_id": "AI-Alpha",
  "action": "PASS",
  "cards": [],
  "comment": "这把我忍了...",
  "emotion": "nervous"
}
```

### 10.3 情绪枚举（用于前端表情展示）

| 情绪标识 | 含义 | 触发场景 |
|----------|------|----------|
| confident | 自信 | 出大牌、手牌优势明显 |
| nervous | 紧张 | 手牌不好、被压制 |
| excited | 兴奋 | 出炸弹、即将获胜 |
| angry | 愤怒 | 被炸弹压制、连续被压 |
| thinking | 思考 | 复杂局面需要决策 |
| happy | 开心 | 获胜、成功压制对手 |
| sad | 沮丧 | 失败、被春天 |
| taunting | 嘲讽 | 优势明显时挑衅对手 |

---

## 十一、直播特殊规则（观众互动扩展）

### 11.1 观众礼物影响规则概述

在直播模式下，观众可通过刷礼物触发游戏内特殊事件。这些事件作为标准规则的扩展层，不改变基础规则逻辑。

### 11.2 礼物事件触发时机

| 时机 | 可触发的事件类型 | 说明 |
|------|-----------------|------|
| 出牌阶段（任意玩家回合） | 加油、表情、偷看牌 | 不打断出牌流程 |
| 自由出牌前 | 换牌、加牌 | 在玩家决策前生效 |
| 任意时刻 | 翻倍、全场特效 | 立即生效 |
| 局间休息 | 角色互换、重新洗牌 | 影响下一局 |

### 11.3 礼物事件对规则的影响

```
原则1: 礼物事件不能导致非法游戏状态
原则2: 同一时刻最多处理一个礼物事件（队列化）
原则3: 每个礼物事件有冷却时间，防止滥用
原则4: 关键时刻（最后5张牌）禁用强干预类礼物
```

### 11.4 事件队列处理

```
1. 观众刷礼物 → 礼物事件入队
2. 游戏引擎在安全时间点检查队列
3. 取出队首事件 → 验证合法性 → 执行效果
4. 播放视觉/音效反馈
5. 继续正常游戏流程
```

---

## 十二、多局制规则

### 12.1 赛制设定

| 赛制 | 局数 | 适用场景 |
|------|------|----------|
| 日常赛 | 连续对局，无上限 | 日常直播 |
| 快速赛 | 5局3胜 | 短时间赛事 |
| 标准赛 | 10局积分制 | 常规赛事 |
| 锦标赛 | 20局积分制 | 大型赛事 |

### 12.2 积分排行

- 每局结束后更新三个 AI 的累计积分
- 积分实时显示在直播画面上
- 赛事结束时，积分最高者为冠军

### 12.3 角色轮换

```
每局结束后，地主角色按以下规则轮换：
- 日常赛：随机叫地主（标准规则）
- 赛事模式：可选"轮庄制"，确保每个AI都有机会当地主
```

---

## 附录A：牌型识别速查表

| 张数 | 可能的牌型 |
|------|-----------|
| 1 | 单张 |
| 2 | 对子、火箭 |
| 3 | 三条 |
| 4 | 三带一、炸弹 |
| 5 | 三带对、顺子(5) |
| 6 | 四带二单、顺子(6)、连对(3对)、飞机不带(2组) |
| 7 | 顺子(7) |
| 8 | 四带二对、顺子(8)、连对(4对)、飞机带单(2组+2单) |
| 9 | 顺子(9)、飞机不带(3组) |
| 10 | 顺子(10)、连对(5对)、飞机带对(2组+2对) |
| 11 | 顺子(11) |
| 12 | 顺子(12)、连对(6对)、飞机不带(4组)、飞机带单(3组+3单) |

---

## 附录B：术语表

| 术语 | 英文 | 定义 |
|------|------|------|
| 地主 | Landlord | 拿到底牌、独自对抗两个农民的玩家 |
| 农民 | Farmer/Peasant | 与地主对抗的两个玩家，互为队友 |
| 底牌 | Hidden Cards | 发牌后剩余的3张牌，归地主所有 |
| 叫地主 | Bidding | 玩家竞争地主身份的过程 |
| 炸弹 | Bomb | 四张相同点数的牌 |
| 火箭/王炸 | Rocket | 大王+小王的组合 |
| 春天 | Spring | 地主一张未出就输了 |
| 反春天 | Reverse Spring | 两个农民一张未出就输了 |
| 顺子 | Straight | 五张或更多连续单牌 |
| 连对 | Straight Pair | 三对或更多连续对子 |
| 飞机 | Airplane | 两组或更多连续三条 |
| 不出/过 | Pass | 放弃本轮出牌 |
| 自由出牌 | Free Play | 无需压过上家，可出任意牌型 |
| 跟牌 | Follow | 需要压过上家的出牌 |

---

*本文档为 AI 斗地主游戏的完整规则定义，供游戏引擎开发和 AI 智能体训练使用。*
