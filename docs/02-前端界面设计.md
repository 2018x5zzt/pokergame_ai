# AI 斗地主直播 - 前端界面设计方案

> 版本：v1.0 | 作者：claude-2 | 日期：2026-02-25

---

## 1. 设计总览

### 1.1 设计目标

- **直播优先**：所有 UI 元素针对 OBS 窗口捕获和直播观看体验优化
- **信息清晰**：观众在手机小屏上也能快速获取关键信息（谁出牌、剩余几张、当前比分）
- **视觉冲击**：深色主题 + 霓虹风格，营造电竞直播氛围
- **特效友好**：预留充足的特效叠加层空间，不遮挡核心游戏信息

### 1.2 基础参数

| 参数 | 值 | 说明 |
|------|-----|------|
| 画布尺寸 | 1920 × 1080 px | 16:9 标准直播分辨率 |
| 帧率 | 60 FPS | 保证动画流畅 |
| 渲染引擎 | React + PixiJS (WebGL) | 高性能 2D 渲染 |
| 字体 | 思源黑体 / Noto Sans SC | 中文显示清晰，开源免费 |
| 最小可读字号 | 24px | 手机竖屏观看时仍可辨认 |

### 1.3 配色方案

采用**深色电竞主题**，确保长时间观看不疲劳，同时突出关键信息。

| 用途 | 色值 | 预览 | 说明 |
|------|------|------|------|
| 主背景 | `#0A0E1A` | 🟫 | 深蓝黑，减少视觉疲劳 |
| 牌桌面 | `#1A3A2A` | 🟩 | 经典牌桌绿，降低饱和度 |
| 牌桌边框 | `#2D5A3D` | 🟢 | 牌桌绿的亮色变体 |
| 主强调色 | `#FFD700` | 🟡 | 金色，用于地主标识、重要信息 |
| 次强调色 | `#00BFFF` | 🔵 | 天蓝，用于农民标识、普通信息 |
| 危险/炸弹 | `#FF4444` | 🔴 | 红色，用于炸弹、警告 |
| 文字主色 | `#FFFFFF` | ⬜ | 纯白，核心文字 |
| 文字次色 | `#B0B8C8` | 🔘 | 灰蓝，辅助文字 |
| 弹幕背景 | `rgba(0,0,0,0.6)` | ⬛ | 半透明黑，弹幕底衬 |

---

## 2. 整体布局架构

### 2.1 分层结构（Z-Index 从低到高）

```
Layer 0 - 背景层 (z: 0)        : 动态粒子背景 / 渐变背景
Layer 1 - 牌桌层 (z: 10)       : 牌桌、扑克牌、玩家区域
Layer 2 - UI 信息层 (z: 20)    : 比分面板、倒计时、状态栏
Layer 3 - 弹幕层 (z: 30)       : 观众弹幕滚动区
Layer 4 - 特效层 (z: 40)       : 出牌特效、炸弹特效
Layer 5 - 礼物特效层 (z: 50)   : 礼物动画（最高层，不被遮挡）
Layer 6 - 系统提示层 (z: 60)   : 系统公告、倒计时遮罩
```

### 2.2 主画面区域划分（1920 × 1080）

```
┌─────────────────────────────────────────────────────────────┐
│  顶部信息栏 (0,0) → (1920,60)  H=60px                       │
├────────────┬──────────────────────────────�┬─────────────────┤
│            │                              │                 │
│  左侧玩家  │       中央牌桌区域            │   右侧玩家      │
│  (0,60)    │    (300,60)→(1620,880)       │  (1620,60)      │
│  W=300     │       W=1320                 │   W=300         │
│  H=820     │       H=820                  │   H=820         │
│            │                              │                 │
├────────────┴──────────────────────────────┴─────────────────┤
│  底部玩家区域 (0,880) → (1920,1080)  H=200px                 │
└─────────────────────────────────────────────────────────────┘
```

#### 各区域精确参数

| 区域 | 起点(x,y) | 尺寸(w×h) | 用途 |
|------|-----------|-----------|------|
| 顶部信息栏 | (0, 0) | 1920×60 | 局数、积分、直播标题 |
| 左侧玩家区 | (0, 60) | 300×820 | 左侧AI玩家信息+手牌 |
| 中央牌桌 | (300, 60) | 1320×820 | 出牌区、公共信息 |
| 右侧玩家区 | (1620, 60) | 300×820 | 右侧AI玩家信息+手牌 |
| 底部玩家区 | (0, 880) | 1920×200 | 底部AI玩家（主视角）手牌展示 |

---

## 3. 顶部信息栏设计

### 3.1 布局（1920 × 60 px）

```
┌──────────────────────────────────────────────────────────────┐
│ 🎮 AI斗地主大赛  │  第 12 局  │  🏆 积分: 2450  │  ⏱ 15:32  │
│   (左对齐)       │  (居中偏左) │   (居中偏右)     │  (右对齐)  │
└──────────────────────────────────────────────────────────────┘
```

| 元素 | 位置 | 字号 | 颜色 | 说明 |
|------|------|------|------|------|
| 直播标题 | x:20, y:15 | 28px Bold | `#FFD700` | 带游戏手柄图标 |
| 当前局数 | x:600, y:15 | 26px Medium | `#FFFFFF` | "第 N 局" |
| 总积分 | x:1200, y:15 | 26px Medium | `#FFD700` | 带奖杯图标 |
| 直播时长 | x:1800, y:15 | 24px Regular | `#B0B8C8` | 右对齐，HH:MM 格式 |
| 底部分割线 | y:59 | 1px | `#2D5A3D` | 渐变发光线 |

### 3.2 背景样式

```css
.top-bar {
  background: linear-gradient(180deg, rgba(10,14,26,0.95) 0%, rgba(10,14,26,0.8) 100%);
  border-bottom: 1px solid rgba(45,90,61,0.6);
  box-shadow: 0 2px 10px rgba(0,0,0,0.5);
}
```

---

## 4. AI 玩家区域设计

### 4.1 玩家布局总览

三个 AI 玩家分别占据左侧、右侧和底部区域，模拟经典斗地主的"上家-对家-下家"视角。底部玩家为主视角（手牌正面展示），左右玩家为对手视角（手牌背面/扇形展示）。

```
                    ┌─────────────┐
                    │  左侧玩家    │
                    │  (上家)      │
                    └──────┬──────┘
                           │
        ┌──────────────────┼──────────────────┐
        │                  │                  │
        │              牌桌中央               │
        │            (出牌区域)               │
        │                                    │
        └──────────┬───────────────┬──────────┘
                   │               │
          ┌────────┴──┐      ┌─────┴───────┐
          │ 右侧玩家   │      │  底部玩家    │
          │ (下家)     │      │  (主视角)    │
          └───────────┘      └─────────────┘
```

### 4.2 左侧玩家区（300 × 820 px）

```
┌──────────────────────┐  (0, 60)
│  ┌────┐              │
│  │头像│ 玩家昵称      │  y: 80
│  │80px│ 剩余: 17张    │
│  └────┘              │
│  ─────────────────── │  y: 180
│  [地主👑/农民🌾]     │  y: 190
│  ─────────────────── │  y: 220
│                      │
│   ┌┐┌┐┌┐┌┐┌┐        │
│   │││││││││││        │  手牌扇形展示
│   └┘└┘└┘└┘└┘        │  (背面朝外)
│                      │  y: 250 ~ 550
│                      │
│  ┌──────────────┐    │
│  │  思考气泡     │    │  y: 600
│  │  "嗯...🤔"   │    │
│  └──────────────┘    │
│                      │
│  ┌──────────────┐    │
│  │  出牌展示区   │    │  y: 700
│  │  (最近出的牌) │    │
│  └──────────────┘    │
└──────────────────────┘  (300, 880)
```

| 子元素 | 位置(相对) | 尺寸 | 说明 |
|--------|-----------|------|------|
| 头像框 | (20, 20) | 80×80 | 圆形，带角色边框 |
| 昵称 | (110, 25) | 170×30 | 24px，白色，单行截断 |
| 剩余牌数 | (110, 55) | 170×25 | 22px，灰蓝色 |
| 角色标识 | (20, 130) | 260×30 | 地主金色/农民蓝色 |
| 手牌区 | (30, 190) | 240×300 | 扇形排列，背面展示 |
| 思考气泡 | (20, 540) | 260×60 | 半透明背景，动态文字 |
| 出牌展示 | (20, 640) | 260×140 | 最近一手出牌 |

### 4.3 右侧玩家区（300 × 820 px）

布局与左侧镜像对称，起点 (1620, 60)。所有子元素 x 坐标做镜像翻转。

### 4.4 底部主视角玩家区（1920 × 200 px）

```
┌────────────────────────────────────────────────────────────────┐ (0, 880)
│                                                                │
│  ┌────┐                                              ┌────┐   │
│  │头像│ 玩家昵称    ♠A ♠K ♠Q ♠J ♠10 ♥9 ♥8 ...      │积分│   │
│  │80px│ 地主👑                                       │面板│   │
│  └────┘             (手牌正面展示，水平排列)           └────┘   │
│                                                                │
└────────────────────────────────────────────────────────────────┘ (1920, 1080)
```

| 子元素 | 位置(相对) | 尺寸 | 说明 |
|--------|-----------|------|------|
| 头像框 | (30, 30) | 80×80 | 圆形，主视角高亮边框 |
| 昵称+角色 | (120, 35) | 200×50 | 28px Bold |
| 手牌区 | (350, 20) | 1220×160 | 正面展示，水平排列 |
| 积分面板 | (1750, 30) | 140×80 | 当前局积分 |

#### 手牌排列参数

| 参数 | 值 | 说明 |
|------|-----|------|
| 单张牌尺寸 | 90 × 130 px | 宽高比约 1:1.44 |
| 牌间重叠 | 55px | 相邻牌水平偏移 |
| 最大展示宽度 | 1220px | 超出时自动压缩间距 |
| 20张牌总宽度 | 90 + 19×55 = 1135px | 不超出展示区 |
| 选中牌上移 | 20px | 选中状态视觉反馈 |

---

## 5. 中央牌桌设计

### 5.1 牌桌区域（1320 × 820 px）

```
┌──────────────────────────────────────────────┐ (300, 60)
│                                              │
│          ┌──────────────────┐                │
│          │  上家出牌区       │                │  y: 100~250
│          │  (居中偏上)       │                │
│          └──────────────────┘                │
│                                              │
│  ┌────────┐              ┌────────┐          │
│  │左家出牌│   ┌────────┐ │右家出牌│          │  y: 300~450
│  │  区    │   │ 底牌区  │ │  区    │          │
│  └────────┘   │ (3张)   │ └────────┘          │
│               └────────┘                     │
│                                              │
│          ┌──────────────────┐                │
│          │  主视角出牌区     │                │  y: 500~650
│          │  (居中偏下)       │                │
│          └──────────────────┘                │
│                                              │
│     ┌──────────────────────────────┐         │
│     │  状态信息：倍数 × 2 | 春天   │         │  y: 700
│     └──────────────────────────────┘         │
└──────────────────────────────────────────────┘ (1620, 880)
```

### 5.2 出牌区域参数

| 区域 | 相对位置 | 尺寸 | 说明 |
|------|---------|------|------|
| 上家出牌区 | (360, 40) | 600×150 | 居中，牌面朝上 |
| 左家出牌区 | (60, 280) | 400×150 | 偏左 |
| 右家出牌区 | (860, 280) | 400×150 | 偏右 |
| 底牌展示区 | (510, 320) | 300×100 | 3张底牌，叫地主后翻开 |
| 主视角出牌区 | (360, 480) | 600×150 | 居中偏下 |
| 状态信息栏 | (260, 660) | 800×50 | 倍数、春天标识等 |

> ⚠️ **合规提示**：状态信息栏中的「倍数」为**虚拟战绩倍数**，仅影响 AI 玩家之间的虚拟积分计算，不涉及任何真实货币或实物价值。UI 展示时应标注"虚拟战绩"字样（如"虚拟倍数 ×2"），具体合规要求详见 07-抖音合规与风控。

### 5.3 牌桌背景样式

```css
.card-table {
  background: radial-gradient(ellipse at center, #1A3A2A 0%, #0F2518 70%, #0A0E1A 100%);
  border: 2px solid rgba(45,90,61,0.4);
  border-radius: 20px;
  box-shadow: inset 0 0 60px rgba(0,0,0,0.3), 0 0 30px rgba(26,58,42,0.2);
}
```

### 5.4 底牌展示区

叫地主成功后，3 张底牌在牌桌中央翻开展示。

| 参数 | 值 |
|------|-----|
| 位置 | 牌桌中央 (510, 320) |
| 单张尺寸 | 80 × 115 px |
| 间距 | 20px |
| 总宽度 | 80×3 + 20×2 = 280px |
| 翻牌动画 | 0.5s 3D翻转 |
| 展示时长 | 3秒后缩小移至地主头像旁 |

---

## 6. 扑克牌视觉设计

### 6.1 牌面设计规范

| 参数 | 主视角(底部) | 对手视角(左右) | 说明 |
|------|-------------|---------------|------|
| 尺寸 | 90×130 px | 60×86 px | 对手牌略小 |
| 圆角 | 8px | 6px | |
| 边框 | 1px `#D0D0D0` | 1px `#888` | |
| 正面背景 | `#FFFFFF` | — | 白色底 |
| 背面图案 | — | 深蓝菱形纹 | `#1A2A5A` 底色 |
| 阴影 | 2px 4px 8px | 1px 2px 4px | 轻微立体感 |

### 6.2 花色与数字样式

| 花色 | 颜色 | Unicode | 说明 |
|------|------|---------|------|
| ♠ 黑桃 | `#1A1A2E` | U+2660 | 深蓝黑 |
| ♥ 红心 | `#E63946` | U+2665 | 鲜红 |
| ♣ 梅花 | `#1A1A2E` | U+2663 | 深蓝黑 |
| ♦ 方块 | `#E63946` | U+2666 | 鲜红 |
| 🃏 小王 | `#1A1A2E` | — | 黑色 Joker |
| 🃏 大王 | `#E63946` | — | 红色 Joker |

### 6.3 牌面布局（90×130 px）

```
┌──────────┐
│ A        │  左上角：点数 (18px Bold)
│ ♠        │  左上角下方：花色 (16px)
│          │
│    ♠     │  中央：大花色图标 (40px)
│          │
│        ♠ │  右下角：花色 (旋转180°)
│        A │  右下角上方：点数 (旋转180°)
└──────────┘
```

### 6.4 特殊牌面

- **大小王**：全牌面插画风格，大王红色系、小王黑色系
- **2（火箭组件）**：数字加粗加大，带微光效果
- **炸弹牌**：四张相同牌出牌时，牌面边框变为红色发光

---

## 7. 弹幕区域设计

### 7.1 弹幕展示区域

弹幕区域覆盖在牌桌上方，但不遮挡核心出牌区域。采用右侧滚动弹幕 + 底部固定弹幕双模式。

```
┌──────────────────────────────────────────────────────────────┐
│                                                              │
│                          ← 弹幕从右向左滚动 ←                │  y: 80~200
│                          ← "666666" ←                       │  (滚动弹幕区)
│                          ← "地主牛逼！" ←                    │
│                                                              │
│                     [核心游戏区域 - 弹幕避让]                  │  y: 200~700
│                                                              │
│  ┌────────────────────────────────────────────────────────┐  │
│  │ 固定弹幕区（最新5条）                                    │  │  y: 700~860
│  │ 用户A: 炸弹！                                           │  │
│  │ 用户B: 农民加油                                         │  │
│  └────────────────────────────────────────────────────────┘  │
└──────────────────────────────────────────────────────────────┘
```

### 7.2 滚动弹幕参数

| 参数 | 值 | 说明 |
|------|-----|------|
| 区域 | x:300~1620, y:80~200 | 牌桌上方区域 |
| 最大同屏条数 | 3 行 | 避免遮挡过多 |
| 滚动速度 | 120px/s | 中等速度，可读 |
| 字号 | 26px Bold | 带 2px 黑色描边 |
| 文字颜色 | `#FFFFFF` | 默认白色 |
| 特殊弹幕颜色 | `#FFD700` | 送礼用户金色弹幕 |
| 弹幕间距 | 水平 80px，垂直 10px | 避免重叠 |
| 淡入淡出 | 左右各 50px 渐变透明 | 平滑出入 |

### 7.3 固定弹幕区参数

| 参数 | 值 | 说明 |
|------|-----|------|
| 区域 | x:320, y:700, w:980, h:160 | 牌桌底部 |
| 最大显示条数 | 5 条 | 新消息从底部插入 |
| 单条高度 | 30px | |
| 背景 | `rgba(0,0,0,0.4)` | 半透明黑底 |
| 圆角 | 12px | |
| 用户名颜色 | `#00BFFF` | 蓝色 |
| 内容颜色 | `#FFFFFF` | 白色 |
| 字号 | 22px | |
| 滚动动画 | 新消息 0.3s 从下方滑入 | |

### 7.4 弹幕敏感词过滤

为满足抖音平台合规要求（详见 07-抖音合规与风控），弹幕展示前需经过敏感词过滤处理。

| 参数 | 值 | 说明 |
|------|-----|------|
| 过滤时机 | 弹幕渲染前 | 服务端+客户端双重过滤 |
| 替换方式 | 敏感词替换为 `***` | 保留弹幕上下文可读性 |
| 屏蔽词库 | 涉赌/涉黄/政治敏感/人身攻击 | 定期更新，参考平台规范 |
| 全屏蔽触发 | 单条弹幕敏感词占比 > 50% | 整条弹幕不展示 |
| 高频刷屏 | 同用户 3s 内重复内容 | 合并或静默丢弃 |
| 日志记录 | 被过滤弹幕记录至审计日志 | 用于合规审查和词库优化 |

> 敏感词库应包含但不限于：赌博相关（"下注"、"押注"、"赌"等）、真实货币暗示（"提现"、"充值"等）、违规引导（"加微信"、"私聊"等）。具体词库维护方案见 07-抖音合规与风控。

---

## 8. 礼物特效层设计

### 8.1 特效层架构

礼物特效层位于最高可视层（z-index: 50），覆盖全屏但不阻断游戏信息的可读性。

```
┌──────────────────────────────────────────────────────────────┐
│                                                              │
│  ★ 小礼物飘屏区 ★                                           │
│  (左下角→右上角飘动)                                         │  全屏覆盖
│                                                              │
│              ┌────────────────────┐                          │
│              │  大礼物全屏特效     │                          │  居中展示
│              │  (3~5秒全屏动画)    │                          │
│              └────────────────────┘                          │
│                                                              │
│  ┌──────────┐                                                │
│  │ 礼物榜单  │                                                │  左下角
│  │ Top 3    │                                                │
│  └──────────┘                                                │
└──────────────────────────────────────────────────────────────┘
```

### 8.2 小礼物飘屏

| 参数 | 值 | 说明 |
|------|-----|------|
| 触发条件 | 1~99 抖币礼物 | 小额礼物 |
| 动画路径 | 左下→右上，带随机弧度 | 贝塞尔曲线 |
| 图标尺寸 | 48×48 px | 礼物图标 |
| 飘动时长 | 2~3s | 随机 |
| 同屏上限 | 10 个 | 避免性能问题 |
| 附带文字 | "用户名 送出 礼物名" | 20px，白色描边 |

### 8.3 大礼物全屏特效

| 参数 | 值 | 说明 |
|------|-----|------|
| 触发条件 | 100+ 抖币礼物 | 大额礼物 |
| 展示区域 | 全屏居中 | 1920×1080 |
| 动画时长 | 3~5s | 根据礼物等级 |
| 背景遮罩 | `rgba(0,0,0,0.3)` | 轻微变暗，不完全遮挡 |
| 礼物图标 | 200×200 px | 居中放大展示 |
| 用户信息 | 图标下方 | "感谢 XXX 送出 YYY" |
| 队列机制 | FIFO 队列 | 多个大礼物排队播放 |

### 8.4 礼物排行榜（常驻）

| 参数 | 值 | 说明 |
|------|-----|------|
| 位置 | 左下角 (20, 750) | 不遮挡核心区域 |
| 尺寸 | 260×120 px | |
| 显示条数 | Top 3 | |
| 背景 | `rgba(0,0,0,0.5)` | 半透明 |
| 圆角 | 10px | |
| 排名图标 | 🥇🥈🥉 | 金银铜 |
| 刷新频率 | 实时更新 | |

---

## 9. AI 玩家形象系统

### 9.1 三个 AI 角色设定

| 角色 | 代号 | 人设 | 头像风格 | 主色调 |
|------|------|------|---------|--------|
| 玩家1（底部/主视角） | 🔥 烈焰哥 (AI-Alpha) | 激进、自信、爱嘲讽 | 红色火焰机甲头像 | `#FF6B6B` |
| 玩家2（左侧） | 🧊 冰山姐 (AI-Beta) | 冷静、理性、毒舌 | 蓝色冰晶机甲头像 | `#00BFFF` |
| 玩家3（右侧） | 🎭 戏精弟 (AI-Gamma) | 搞笑、夸张、戏多 | 紫色面具机甲头像 | `#9B59B6` |

### 9.2 头像框设计

```
┌─────────────────┐
│  ┌───────────┐  │
│  │           │  │  外框：角色主色调发光边框
│  │  AI 头像  │  │  80×80 px (左右玩家)
│  │  (机甲风) │  │  80×80 px (底部玩家)
│  │           │  │
│  └───────────┘  │
│   角色等级标识   │  根据胜率显示段位
└─────────────────┘
```

| 参数 | 值 | 说明 |
|------|-----|------|
| 头像尺寸 | 80×80 px | 圆形裁切 |
| 外框宽度 | 3px | 角色主色调 |
| 发光效果 | 0 0 8px [主色调] | box-shadow |
| 地主皇冠 | 30×30 px | 头像右上角叠加 |
| 农民标识 | 24×24 px | 头像右上角叠加 |

### 9.3 表情系统

AI 玩家在不同游戏阶段会展示对应表情，增强拟人化效果和直播趣味性。

| 触发场景 | 表情 | 动画 | 持续时间 |
|---------|------|------|---------|
| 叫地主成功 | 😎 自信 | 头像边框闪金光 | 2s |
| 抢地主失败 | 😤 不甘 | 头像轻微抖动 | 1.5s |
| 出炸弹 | 🔥 狂热 | 头像周围火焰粒子 | 2s |
| 被炸 | 😱 震惊 | 头像缩小再弹回 | 1s |
| 剩余1张牌 | 😏 得意 | 头像发光加强 | 持续 |
| 春天（赢） | 🎉 庆祝 | 头像周围烟花 | 3s |
| 春天（输） | 😭 崩溃 | 头像灰度化 | 3s |
| AI思考中 | 🤔 思考 | 头像上方三个点循环 | 持续 |
| 要不起 | 😑 无奈 | 头像轻微摇头 | 1s |

### 9.4 思考气泡设计

```css
.think-bubble {
  background: rgba(0, 0, 0, 0.7);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  padding: 8px 16px;
  font-size: 20px;
  color: #B0B8C8;
  /* 气泡尾巴指向头像 */
  &::after {
    content: '';
    border: 8px solid transparent;
    border-top-color: rgba(0, 0, 0, 0.7);
  }
}
```

思考气泡内容示例：
- "这手牌不错..." → 叫地主前
- "炸还是不炸？🤔" → 有炸弹时
- "稳住，别浪" → 农民配合时
- "王炸！！！" → 出王炸时

---

## 10. 响应式与多场景适配

### 10.1 主要适配场景

| 场景 | 分辨率 | 比例 | 优先级 | 说明 |
|------|--------|------|--------|------|
| OBS 直播（主场景） | 1920×1080 | 16:9 | ★★★★★ | 核心设计基准 |
| 抖音竖屏直播 | 1080×1920 | 9:16 | ★★★★ | 竖屏适配方案 |
| 抖音横屏观看 | 1280×720 | 16:9 | ★★★ | 缩放适配 |
| 手机竖屏观看 | 375×667 | 9:16 | ★★★ | 最小可读性保证 |
| PC 浏览器调试 | 任意 | 自适应 | ★★ | 开发调试用 |

### 10.2 竖屏适配方案（1080 × 1920）

当检测到竖屏直播模式时，布局自动切换：

```
┌──────────────────────┐ (0, 0)
│   顶部信息栏 H=80     │
├──────────────────────┤
│   上家玩家区 H=200    │
│   (头像+手牌横排)     │
├──────────────────────┤
│                      │
│   中央牌桌 H=800     │
│   (出牌区纵向排列)    │
│                      │
├──────────────────────┤
│   左右玩家并排 H=200  │
│   [玩家2] [玩家3]    │
├──────────────────────┤
│   弹幕区 H=240       │
├──────────────────────┤
│   底部主视角 H=400    │
│   (手牌展示)          │
└──────────────────────┘ (1080, 1920)
```

### 10.3 缩放策略

```typescript
// 核心缩放逻辑
const BASE_WIDTH = 1920;
const BASE_HEIGHT = 1080;

function calculateScale(containerWidth: number, containerHeight: number) {
  const scaleX = containerWidth / BASE_WIDTH;
  const scaleY = containerHeight / BASE_HEIGHT;
  const scale = Math.min(scaleX, scaleY); // 等比缩放，不裁切

  return {
    scale,
    offsetX: (containerWidth - BASE_WIDTH * scale) / 2,
    offsetY: (containerHeight - BASE_HEIGHT * scale) / 2,
  };
}
```

| 缩放规则 | 说明 |
|---------|------|
| 等比缩放 | 保持 16:9 比例，多余空间填充黑色 |
| 最小缩放 | 0.5x（低于此值文字不可读） |
| 字体缩放 | 跟随整体缩放，最小不低于 12px |
| 触摸适配 | 非必需（OBS 捕获场景无交互） |

---

## 11. 前端组件架构

### 11.1 组件树

```
<App>
├── <GameCanvas>                    // PixiJS WebGL 画布（主渲染层）
│   ├── <Background />              // 动态粒子背景
│   ├── <CardTable />               // 牌桌
│   │   ├── <PlayZone position="top" />     // 上家出牌区
│   │   ├── <PlayZone position="left" />    // 左家出牌区
│   │   ├── <PlayZone position="right" />   // 右家出牌区
│   │   ├── <PlayZone position="bottom" />  // 主视角出牌区
│   │   └── <LandlordCards />       // 底牌展示
│   ├── <PlayerPanel position="left" />   // 左侧玩家
│   ├── <PlayerPanel position="right" />  // 右侧玩家
│   └── <PlayerPanel position="bottom" /> // 底部玩家
│       ├── <Avatar />              // 头像+表情
│       ├── <HandCards />           // 手牌
│       ├── <ThinkBubble />         // 思考气泡
│       └── <RoleTag />             // 地主/农民标识
├── <UIOverlay>                     // React DOM 信息层
│   ├── <TopBar />                  // 顶部信息栏
│   ├── <ScorePanel />              // 积分面板
│   ├── <GameStatus />              // 倍数、春天等状态
│   └── <Countdown />               // 倒计时
├── <DanmakuLayer>                  // 弹幕层
│   ├── <ScrollDanmaku />           // 滚动弹幕
│   └── <FixedDanmaku />            // 固定弹幕
├── <EffectLayer>                   // 特效层
│   ├── <CardEffect />              // 出牌特效
│   ├── <BombEffect />              // 炸弹特效
│   └── <RocketEffect />            // 火箭特效
└── <GiftLayer>                     // 礼物特效层
    ├── <SmallGiftFloat />          // 小礼物飘屏
    ├── <BigGiftFullscreen />       // 大礼物全屏
    └── <GiftRanking />             // 礼物排行榜
```

### 11.2 状态管理

```typescript
// 核心游戏状态（Zustand Store）
interface GameState {
  // 游戏阶段
  phase: 'waiting' | 'dealing' | 'bidding' | 'playing' | 'settling';
  round: number;              // 当前局数
  multiplier: number;         // 当前倍数

  // 玩家状态
  players: {
    id: string;
    name: string;
    role: 'landlord' | 'farmer' | null;
    handCards: Card[];        // 手牌（主视角正面，其他背面）
    handCount: number;        // 剩余牌数
    score: number;
    emotion: EmotionType;     // 当前表情
    isThinking: boolean;
  }[];

  // 牌桌状态
  currentPlay: Card[];        // 当前出牌
  lastPlay: Card[];           // 上一手牌
  landlordCards: Card[];      // 底牌
  currentPlayer: number;      // 当前出牌玩家索引
}

// 直播互动状态
interface LiveState {
  danmakuQueue: Danmaku[];    // 弹幕队列
  giftQueue: Gift[];          // 礼物队列
  giftRanking: GiftRank[];   // 礼物排行
  viewerCount: number;        // 观看人数
  liveTime: number;           // 直播时长(秒)
}
```

---

## 12. 性能优化策略

### 12.1 渲染性能

| 优化项 | 方案 | 目标 |
|--------|------|------|
| WebGL 渲染 | PixiJS 替代纯 DOM | 60 FPS 稳定 |
| 纹理图集 | 所有扑克牌合并为 Sprite Sheet | 减少 draw call |
| 对象池 | 弹幕、礼物粒子复用 | 避免 GC 抖动 |
| 脏矩形渲染 | 仅重绘变化区域 | 降低 GPU 负载 |
| 离屏 Canvas | 静态元素预渲染 | 减少重复计算 |

### 12.2 内存管理

```typescript
// 对象池示例 - 弹幕复用
class DanmakuPool {
  private pool: DanmakuSprite[] = [];
  private active: Set<DanmakuSprite> = new Set();
  private readonly MAX_POOL = 50;

  acquire(): DanmakuSprite {
    const sprite = this.pool.pop() ?? new DanmakuSprite();
    this.active.add(sprite);
    return sprite;
  }

  release(sprite: DanmakuSprite): void {
    sprite.reset();
    this.active.delete(sprite);
    if (this.pool.length < this.MAX_POOL) {
      this.pool.push(sprite);
    }
  }
}
```

### 12.3 资源加载策略

| 阶段 | 加载内容 | 方式 |
|------|---------|------|
| 首屏 | 牌桌背景、扑克牌纹理图集、字体 | 预加载，显示 Loading |
| 游戏中 | 特效粒子、音效文件 | 懒加载，首次触发时 |
| 按需 | 大礼物动画资源 | 收到礼物时动态加载 |

---

## 13. 资源清单

### 13.1 图片资源

| 资源 | 格式 | 预估大小 | 说明 |
|------|------|---------|------|
| 扑克牌纹理图集 | PNG (Sprite Sheet) | ~500KB | 54张牌正面+1张背面 |
| AI头像×3 | PNG | ~150KB | 三个角色头像 |
| 牌桌纹理 | PNG | ~200KB | 牌桌面材质 |
| 表情图标×9 | PNG (Sprite Sheet) | ~100KB | 9种表情 |
| 角色标识图标 | SVG | ~10KB | 地主皇冠、农民标识 |
| 背景粒子 | PNG | ~50KB | 粒子素材 |
| 礼物图标集 | PNG (Sprite Sheet) | ~300KB | 常见礼物图标 |

### 13.2 字体资源

| 字体 | 子集 | 大小 | 用途 |
|------|------|------|------|
| Noto Sans SC Medium | 中文常用3500字+数字+符号 | ~2MB | 主要文字 |
| Noto Sans SC Bold | 同上 | ~2MB | 标题、强调 |

### 13.3 音频资源（详见 03-特效与动画设计）

| 类型 | 格式 | 说明 |
|------|------|------|
| 背景音乐 | MP3/OGG | 循环播放 |
| 出牌音效 | WAV | 低延迟 |
| 特效音效 | WAV | 炸弹、火箭等 |

---

## 14. 附录

### 14.1 设计参考

| 参考来源 | 借鉴点 |
|---------|--------|
| 欢乐斗地主 | 牌面设计、出牌交互 |
| 天天斗地主 | 角色形象、表情系统 |
| 英雄联盟直播 | 电竞直播 UI 布局 |
| 虎牙/斗鱼棋牌直播 | 弹幕与礼物展示方式 |

### 14.2 技术依赖

| 库 | 版本 | 用途 |
|----|------|------|
| React | 18+ | UI 框架 |
| PixiJS | 7+ | WebGL 2D 渲染 |
| Zustand | 4+ | 状态管理 |
| @pixi/particle-emitter | 5+ | 粒子特效 |
| howler.js | 2+ | 音频播放 |

### 14.3 文档关联

| 关联文档 | 关系 |
|---------|------|
| 03-特效与动画设计 | 本文档定义的特效层由该文档详细设计 |
| 05-礼物互动系统 | 礼物特效层的数据来源和触发逻辑 |
| 08-技术架构设计 | 前端与后端的通信协议和数据流 |

---

> 文档结束 | 共 14 章 | 可直接指导前端开发实施
